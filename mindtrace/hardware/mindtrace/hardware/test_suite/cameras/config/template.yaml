# ==============================================================================
# CAMERA TEST CONFIGURATION TEMPLATE
# ==============================================================================
#
# This is the DEFINITIVE TEMPLATE for all camera test configurations.
# All test configs should follow this structure and documentation style.
#
# This template documents ALL available camera configuration parameters
# aligned with CameraSettings from mindtrace.hardware.core.config
#
# Parameters are organized into 3 categories:
#   - RUNTIME: Changeable during operation via /cameras/configure
#   - STARTUP: Require camera reinitialization to change
#   - SYSTEM: Manager-level settings, not per-camera
#
# Use this as the authoritative reference when creating new test configurations.
#
# ==============================================================================

# ==============================================================================
# TEST IDENTIFICATION
# ==============================================================================
name: template_test
description: |
  Template description explaining what this test does.

  Purpose: What is being tested
  Scope: What operations are performed
  Duration: Estimated runtime

  Use this template as the foundation for all new test configurations.

# ==============================================================================
# API CONFIGURATION
# ==============================================================================
api:
  base_url: http://localhost:8003  # Camera API endpoint
  timeout: 30.0                     # HTTP request timeout in seconds

# ==============================================================================
# HARDWARE SELECTION
# ==============================================================================
hardware:
  backend: Basler  # Options: Basler, OpenCV, Mock
  camera_selection:
    strategy: index  # Options: index, serial, first, all
    value: 0         # Camera index (for 'index' strategy)
                     # For 'serial': provide camera serial number
                     # For 'first'/'all': value not needed

# ==============================================================================
# CAMERA CONFIGURATION (ALIGNED WITH CameraSettings)
# ==============================================================================
camera_config:

  # ----------------------------------------------------------------------------
  # RUNTIME-CONFIGURABLE PARAMETERS
  # These can be changed during operation via /cameras/configure API
  # ----------------------------------------------------------------------------
  runtime:
    # === Capture Timeout ===
    timeout_ms: 5000              # Capture timeout in milliseconds
                                   # SDK-level timeout for RetrieveResult()
                                   # Default: 5000 (5 seconds)

    # === Image Quality Parameters ===
    exposure_time: 2000.0         # Exposure time in microseconds
                                   # Controls how long sensor is exposed to light
                                   # Typical range: 100-50000 (0.1ms to 50ms)
                                   # Default: 1000.0 (1ms)

    gain: 1.5                     # Camera gain value (brightness amplification)
                                   # Higher values = brighter but more noise
                                   # Typical range: 0.0-4.0
                                   # Default: 1.0

    trigger_mode: "continuous"    # Trigger mode: "continuous" or "trigger"
                                   # continuous: Camera captures freely
                                   # trigger: Waits for external trigger signal
                                   # Default: "continuous"

    white_balance: "auto"         # White balance mode: "auto", "off", or "once"
                                   # auto: Continuously adjust white balance
                                   # once: Adjust once then lock
                                   # off: Manual white balance (fixed values)
                                   # Default: "auto"

    pixel_format: "BGR8"          # Pixel format for captured images
                                   # Options: BGR8, RGB8, Mono8, YUV422, etc.
                                   # BGR8 is OpenCV-friendly format
                                   # Default: "BGR8"

    image_quality_enhancement: false  # Enable CLAHE (Contrast Limited Adaptive Histogram Equalization)
                                      # Enhances local contrast in images
                                      # Useful for low-contrast scenes
                                      # Default: false

    # === OpenCV Backend Specific ===
    # Only used when backend is OpenCV (USB cameras)
    opencv_default_width: 1280    # Frame width in pixels
                                   # Common values: 640, 1280, 1920
                                   # Default: 1280

    opencv_default_height: 720    # Frame height in pixels
                                   # Common values: 480, 720, 1080
                                   # Default: 720

    opencv_default_fps: 30        # Frames per second
                                   # Common values: 15, 30, 60
                                   # Default: 30

    opencv_default_exposure: -1.0 # OpenCV exposure control
                                   # -1 = auto exposure
                                   # 0-1 = manual exposure (normalized)
                                   # Default: -1.0 (auto)

  # ----------------------------------------------------------------------------
  # STARTUP-ONLY PARAMETERS
  # These require camera reinitialization to change (not changeable via configure)
  # ----------------------------------------------------------------------------
  startup:
    buffer_count: 25                      # Number of frame buffers to allocate
                                           # More buffers = better handling of burst captures
                                           # Typical range: 10-50
                                           # Default: 25

    basler_multicast_enabled: false       # Enable multicast mode (Basler only)
                                           # Allows multiple receivers for same stream
                                           # Requires network infrastructure support
                                           # Default: false

    basler_multicast_group: "239.192.1.1" # Multicast group IP address
                                           # Used when multicast_enabled is true
                                           # Must be valid multicast IP (239.x.x.x)
                                           # Default: "239.192.1.1"

    basler_multicast_port: 3956           # Multicast port number
                                           # Used when multicast_enabled is true
                                           # Default: 3956

    basler_target_ips: []                 # Target IPs for camera discovery
                                           # List of specific IPs to search
                                           # Empty list = search all interfaces
                                           # Example: ["192.168.50.10", "192.168.50.11"]
                                           # Default: []

  # ----------------------------------------------------------------------------
  # SYSTEM CONFIGURATION PARAMETERS
  # Manager-level settings, affect overall camera system behavior
  # ----------------------------------------------------------------------------
  system:
    retrieve_retry_count: 3         # Number of retry attempts for failed captures
                                     # Application-level resilience layer
                                     # 0 = no retries, just fail immediately
                                     # Typical range: 0-5
                                     # Default: 3

    max_concurrent_captures: 2      # Maximum simultaneous camera captures
                                     # Bandwidth management for multi-camera setups
                                     # Lower = less network congestion
                                     # Higher = faster parallel captures
                                     # Typical range: 1-4
                                     # Default: 2

    max_camera_index: 1             # Maximum camera index to scan (OpenCV only)
                                     # Limits OpenCV camera discovery
                                     # 0 = only check /dev/video0
                                     # 1 = check /dev/video0 and /dev/video1
                                     # Default: 1

    mock_camera_count: 10           # Number of mock cameras (Mock backend only)
                                     # Used for testing without hardware
                                     # Default: 10

    enhancement_gamma: 2.2          # Gamma correction value for image enhancement
                                     # Used when image_quality_enhancement is true
                                     # <1.0 = darker, >1.0 = brighter
                                     # Typical range: 1.0-3.0
                                     # Default: 2.2

    enhancement_contrast: 1.2       # Contrast enhancement factor
                                     # Used when image_quality_enhancement is true
                                     # <1.0 = less contrast, >1.0 = more contrast
                                     # Typical range: 0.5-2.0
                                     # Default: 1.2

    # OpenCV parameter validation ranges (system-level configuration)
    opencv_exposure_range_min: -13.0     # Minimum OpenCV exposure value
    opencv_exposure_range_max: -1.0      # Maximum OpenCV exposure value
    opencv_width_range_min: 160          # Minimum frame width
    opencv_width_range_max: 1920         # Maximum frame width
    opencv_height_range_min: 120         # Minimum frame height
    opencv_height_range_max: 1080        # Maximum frame height

# ==============================================================================
# TEST EXECUTION PARAMETERS
# These control test behavior, NOT camera configuration
# ==============================================================================
test:
  capture_count: 10               # How many capture iterations to run
  delay_between_operations: 0.1   # Delay between operations in seconds
  parallel_operations: false      # Run operations in parallel (if supported)

# ==============================================================================
# EXPECTATIONS
# Define expected outcomes and test criteria
# ==============================================================================
expectations:
  total_timeout: 300.0            # Total test timeout in seconds
  timeout_per_operation: 10.0     # Per-operation timeout in seconds
  expected_success_rate: 0.95     # Expected success rate (0.0-1.0)
                                   # 0.95 = 95% of operations should succeed

# ==============================================================================
# TAGS
# Categorize tests for filtering and organization
# ==============================================================================
tags:
  - template
  - reference
  - documentation

# ==============================================================================
# TEST OPERATIONS
# Define the sequence of operations to perform
# ==============================================================================
operations:
  # Step 1: Discovery - find available cameras
  - action: discover
    payload:
      backend: "$hardware.backend"
    timeout: 10.0
    store_result: discovered_cameras

  # Step 2: Open camera connection
  - action: open
    payload:
      camera: "$discovered_cameras[$hardware.camera_selection.value]"
      test_connection: true
    timeout: 15.0

  # Step 3: Configure camera with runtime parameters
  - action: configure
    payload:
      camera: "$discovered_cameras[$hardware.camera_selection.value]"
      properties: "$camera_config.runtime"  # All runtime params from above
    timeout: 5.0

  # Step 4: Capture test images
  - action: capture
    payload:
      camera: "$discovered_cameras[$hardware.camera_selection.value]"
    timeout: 10.0
    repeat: "$test.capture_count"
    delay: "$test.delay_between_operations"

# ==============================================================================
# CLEANUP OPERATIONS
# Always run at the end, even if test fails
# ==============================================================================
cleanup_operations:
  - action: close
    payload:
      camera: "$discovered_cameras[$hardware.camera_selection.value]"
    timeout: 5.0

# ==============================================================================
# USAGE NOTES
# ==============================================================================
#
# Creating New Tests:
# 1. Copy this template.yaml
# 2. Rename to descriptive name (e.g., smoke_test.yaml, stress_test.yaml)
# 3. Update name, description, and tags
# 4. Adjust camera_config parameters for your test scenario
# 5. Modify operations sequence as needed
# 6. Set appropriate expectations for success criteria
#
# Parameter References:
# - Use "$path.to.value" syntax to reference other config values
# - Example: "$hardware.backend" references the backend field
# - Supports nested paths and array indexing
#
# Operation Actions Available:
# - discover: Find available cameras
# - open: Open camera connection
# - configure: Update camera settings
# - capture: Capture image/frame
# - close: Close camera connection
#
# Testing Your Config:
# python run_test.py --config your_test_name
#
# ==============================================================================
