# Stream Stress Test Configuration
# Streaming stability and resource cleanup testing

name: stream_stress
description: Test streaming stability with repeated start/stop cycles

# API Configuration
api:
  base_url: http://localhost:8003
  timeout: 30.0

# Hardware Configuration
hardware:
  backend: Basler
  camera_count: 1

# Test Parameters
test:
  stream_cycles: 10
  stream_duration: 5.0  # seconds per cycle
  stream_quality: 85
  stream_fps: 30
  exposure_us: 10000  # 10ms for streaming

# Expectations
expectations:
  total_timeout: 300.0  # 5 minutes
  timeout_per_operation: 15.0
  expected_success_rate: 0.90  # 90% success expected

# Tags
tags:
  - stream
  - stress
  - stability

# Test Operations
operations:
  - action: discover
    payload:
      backend: Basler
    timeout: 10.0
    store_result: cameras

  - action: open
    payload:
      camera: "$cameras[0]"
      test_connection: true
    timeout: 15.0

  - action: configure
    payload:
      camera: "$cameras[0]"
      properties:
        exposure: 10000
    timeout: 5.0

  # Stream cycle 1
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 2
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 3
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 4
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 5
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 6
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 7
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 8
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 9
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

  # Stream cycle 10
  - action: start_stream
    payload:
      camera: "$cameras[0]"
      quality: 85
      fps: 30
    timeout: 10.0

  - action: wait
    payload:
      duration: 5.0
    timeout: 6.0

  - action: stop_stream
    payload:
      camera: "$cameras[0]"
    timeout: 5.0

# Cleanup Operations (always run)
cleanup_operations:
  - action: close
    payload:
      camera: "$cameras[0]"
    timeout: 5.0
